From 4572ec12d7a64bc4401295c9e93d40d83f77c477 Mon Sep 17 00:00:00 2001
From: zimolab <zimolab@aliyun.com>
Date: Sun, 14 Sep 2025 02:26:29 +0800
Subject: [PATCH] add mipi-dsi lcd support for d300t9307v0 and d350t1013v1

---
 .../rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi  | 143 +++++++++++++++++
 .../rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi  | 144 ++++++++++++++++++
 .../boot/dts/rk3506b-luckfox-lyra-zero-w.dts  |   3 +
 3 files changed, 290 insertions(+)
 create mode 100644 arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi
 create mode 100644 arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi

diff --git a/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi b/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi
new file mode 100644
index 000000000..62e46501a
--- /dev/null
+++ b/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi
@@ -0,0 +1,143 @@
+/*
+* 适用于大显3.0英寸显示屏的设备树配置
+* 型号：D300T9307V0
+* 分辨率：480 * 854（RGB点阵屏）
+* 接口：MIPI DSI（2-lane）
+* 驱动：st7701s
+* 触摸：有
+* 触摸i2c：ft5x06（兼容）
+*
+* created by: zimolab(https://github.com/zimolab)
+* created at: 2025-9-14
+*/
+/dts-v1/;
+
+#include "rk3506-luckfox-lyra-ultra.dtsi"
+
+
+// // 背光配置
+&backlight{
+	status = "okay";
+};
+
+// MIPI DSI配置
+&dsi {
+	status = "okay";
+};
+
+&dsi_panel {
+	status = "okay";
+	compatible = "simple-panel-dsi";
+	reg = <0>;
+	backlight = <&backlight>;
+	
+	prepare-delay-ms = <120>;
+	reset-delay-ms = <120>;
+	init-delay-ms = <120>;
+	disable-delay-ms = <120>;
+	unprepare-delay-ms = <120>;
+	
+	dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_NO_EOT_PACKET )>;
+	dsi,format = <MIPI_DSI_FMT_RGB888>;
+	dsi,lanes  = <2>;
+	
+	// mipi初始化序列
+	panel-init-sequence = [
+	39 00 06 FF 77 01 00 00 13
+	15 00 02 EF 08
+	39 00 06 FF 77 01 00 00 10
+	39 00 03 C0 E9 03
+	39 00 03 C1 0F 0C
+	39 00 03 C2 27 0A
+	15 00 02 CC 10
+	39 00 11 B0 00 23 2A 0A 0E 03 12 06 06 2A 00 10 0F 2D 34 1F
+	39 00 11 B1 00 24 2B 0F 12 07 15 0A 0A 2B 08 13 10 2D 33 1F
+	39 00 06 FF 77 01 00 00 11
+	15 00 02 B0 5D
+	15 00 02 B1 74
+	15 00 02 B2 84
+	15 00 02 B3 80
+	15 00 02 B5 45
+	15 00 02 B7 85
+	15 00 02 B8 33
+	15 00 02 C1 78
+	15 00 02 C2 78
+	15 64 02 D0 88
+	39 00 04 E0 00 00 02
+	39 00 0C E1 06 A0 08 A0 05 A0 07 A0 00 44 44
+	39 00 0D E2 30 30 44 44 6E A0 00 00 6E A0 00 00
+	39 00 05 E3 00 00 33 33
+	39 00 03 E4 44 44
+	39 00 11 E5 0D 69 0A A0 0F 6B 0A A0 09 65 0A A0 0B 67 0A A0
+	39 00 05 E6 00 00 33 33
+	39 00 03 E7 44 44
+	39 00 11 E8 0C 68 0A A0 0E 6A 0A A0 08 64 0A A0 0A 66 0A A0
+	39 00 03 E9 36 00
+	39 00 08 EB 00 01 E4 E4 44 88 40
+	39 00 11 ED FF 45 67 FA 01 2B CF FF FF FC B2 10 AF 76 54 FF
+	39 00 07 EF 10 0D 04 08 3F 1F
+	39 00 06 FF 77 01 00 00 00
+	15 00 02 36 00
+	15 00 02 3A 77
+	05 78 01 11
+	05 14 01 29
+	];
+	
+	// 面板退出序列
+	panel-exit-sequence = [
+	05 00 01 28
+	05 00 01 10
+	];
+	
+};
+
+&disp_timings0 {
+	native-mode = <&dsi_timing_d300t9307v0>;
+	
+	dsi_timing_d300t9307v0: dsi_timing_d300t9307v0 {
+		clock-frequency = <27000000>;// 时钟频率
+		hactive = <480>;// 水平像素
+		vactive = <854>;// 垂直像素
+		hfront-porch = <8>;// 水平前廊
+		hsync-len = <2>;// 水平同步长度
+		hback-porch = <43>;// 水平后廊
+		vfront-porch = <4>;// 垂直前廊
+		vsync-len = <10>;// 垂直同步长度
+		vback-porch = <42>;// 垂直后廊
+		hsync-active = <0>;// 水平同步极性激活
+		vsync-active = <0>;// 垂直同步极性激活
+		de-active = <0>;// 数据使能极性激活
+		pixelclk-active = <1>;// 像素时钟极性激活
+	};
+};
+
+&i2c2{
+	status = "okay";
+};
+
+
+/*
+* 触摸IC所在I2C总线：I2C2
+* 触摸IC地址：0x38
+* 触摸IC兼容驱动：edt-ft5506
+* 触摸IC中断引脚：GPIO1_C4
+*/
+&ft5406{
+	status = "okay";
+	compatible = "edt,edt-ft5506";
+	reg = <0x38>;
+	
+	/delete-property/ touchscreen-inverted-x;
+	/delete-property/ touchscreen-inverted-y;
+	/delete-property/ touchscreen-swapped-x-y;
+	touchscreen-inverted-x;
+	
+	
+	touchscreen-size-x = <480>;
+	touchscreen-size-y = <854>;
+	
+	touch-gpio = <&gpio1 RK_PC4 IRQ_TYPE_EDGE_RISING>;
+	interrupt-parent = <&gpio1>;
+	interrupts = <RK_PC4 IRQ_TYPE_LEVEL_LOW>;
+	
+};
\ No newline at end of file
diff --git a/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi b/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi
new file mode 100644
index 000000000..27bf24617
--- /dev/null
+++ b/arch/arm/boot/dts/rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi
@@ -0,0 +1,144 @@
+/*
+* 适用于大显3.5英寸显示屏的设备树配置
+* 型号：D350T1013V1
+* 分辨率：480 * 800（RGB点阵屏）
+* 接口：MIPI DSI（2-lane）
+* 驱动：st7701s
+* 触摸：有
+* 触摸i2c：ft5x06（兼容）
+*
+* created by: zimolab(https://github.com/zimolab)
+* created at: 2025-9-14
+*/
+/dts-v1/;
+
+#include "rk3506-luckfox-lyra-ultra.dtsi"
+
+
+// // 背光配置
+&backlight{
+	status = "okay";
+};
+
+// MIPI DSI配置
+&dsi {
+	status = "okay";
+};
+
+&dsi_panel {
+	status = "okay";
+	compatible = "simple-panel-dsi";
+	reg = <0>;
+	backlight = <&backlight>;
+	
+	prepare-delay-ms = <120>;
+	reset-delay-ms = <120>;
+	init-delay-ms = <120>;
+	disable-delay-ms = <120>;
+	unprepare-delay-ms = <120>;
+	
+	dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_NO_EOT_PACKET )>;
+	dsi,format = <MIPI_DSI_FMT_RGB888>;
+	dsi,lanes  = <2>;
+	
+	// mipi初始化序列
+	panel-init-sequence = [
+	39 00 06 FF 77 01 00 00 11
+	15 00 02 D1 11
+	15 00 02 55 B0
+	39 00 06 FF 77 01 00 00 10
+	39 00 03 C0 63 00
+	39 00 03 C1 09 02
+	39 00 03 C2 37 08
+	15 00 02 C7 00
+	15 00 02 CC 38
+	39 00 11 B0 C0 0C 92 0C 10 05 02 0D 07 21 04 53 11 6A 32 1F
+	39 00 11 B1 C0 87 CF 0C 10 06 00 03 08 1D 06 54 12 E6 EC 0F
+	39 00 06 FF 77 01 00 00 11
+	15 00 02 B0 5D
+	15 00 02 B1 62
+	15 00 02 B2 82
+	15 00 02 B3 80
+	15 00 02 B5 42
+	15 00 02 B7 85
+	15 00 02 B8 20
+	15 00 02 C0 09
+	15 00 02 C1 78
+	15 00 02 C2 78
+	15 00 02 D0 88
+	15 64 02 EE 42
+	39 00 04 E0 00 00 02
+	39 00 0C E1 04 A0 06 A0 05 A0 07 A0 00 44 44
+	39 00 0D E2 00 00 33 33 01 A0 00 00 01 A0 00 00
+	39 00 05 E3 00 00 33 33
+	39 00 03 E4 44 44
+	39 00 11 E5 0C 30 A0 A0 0E 32 A0 A0 08 2C A0 A0 0A 2E A0 A0
+	39 00 05 E6 00 00 33 33
+	39 00 03 E7 44 44
+	39 00 11 E8 0D 31 A0 A0 0F 33 A0 A0 09 2D A0 A0 0B 2F A0 A0
+	39 00 08 EB 00 01 E4 E4 44 88 00
+	39 00 11 ED FF F5 47 6F 0B A1 A2 BF FB 2A 1A B0 F6 74 5F FF
+	15 00 02 EE 42
+	39 00 06 FF 77 01 00 00 00
+	15 00 02 36 00
+	15 00 02 3A 70
+	05 C8 01 11
+	05 32 01 29
+	];
+	
+	// 面板退出序列
+	panel-exit-sequence = [
+	05 00 01 28
+	05 00 01 10
+	];
+	
+};
+
+&disp_timings0 {
+	native-mode = <&dsi_timing_d350t1013v1>;
+	
+	dsi_timing_d350t1013v1: dsi_timing_d350t1013v1 {
+		clock-frequency = <30816000>;// 时钟频率
+		hactive = <480>;// 水平像素
+		vactive = <800>;// 垂直像素
+		hfront-porch = <50>;// 水平前廊
+		hsync-len = <10>;// 水平同步长度
+		hback-porch = <60>;// 水平后廊
+		vfront-porch = <34>;// 垂直前廊
+		vsync-len = <2>;// 垂直同步长度
+		vback-porch = <20>;// 垂直后廊
+		hsync-active = <0>;// 水平同步极性激活
+		vsync-active = <0>;// 垂直同步极性激活
+		de-active = <0>;// 数据使能极性激活
+		pixelclk-active = <1>;// 像素时钟极性激活
+	};
+};
+
+&i2c2{
+	status = "okay";
+};
+
+
+/*
+* 触摸IC所在I2C总线：I2C2
+* 触摸IC地址：0x38
+* 触摸IC兼容驱动：edt-ft5506
+* 触摸IC中断引脚：GPIO1_C4
+*/
+&ft5406{
+	status = "okay";
+	compatible = "edt,edt-ft5506";
+	reg = <0x38>;
+	
+	/delete-property/ touchscreen-inverted-x;
+	/delete-property/ touchscreen-inverted-y;
+	/delete-property/ touchscreen-swapped-x-y;	
+	
+	touchscreen-size-x = <480>;
+	touchscreen-size-y = <800>;
+	
+	touch-gpio = <&gpio1 RK_PC4 IRQ_TYPE_EDGE_RISING>;
+	interrupt-parent = <&gpio1>;
+	interrupts = <RK_PC4 IRQ_TYPE_LEVEL_LOW>;
+	
+};
\ No newline at end of file
diff --git a/arch/arm/boot/dts/rk3506b-luckfox-lyra-zero-w.dts b/arch/arm/boot/dts/rk3506b-luckfox-lyra-zero-w.dts
index 761555eb8..68e61c59f 100644
--- a/arch/arm/boot/dts/rk3506b-luckfox-lyra-zero-w.dts
+++ b/arch/arm/boot/dts/rk3506b-luckfox-lyra-zero-w.dts
@@ -5,7 +5,10 @@
 
 /dts-v1/;
 
+
 #include "rk3506-luckfox-lyra-ultra.dtsi"
+//#include "rk3506-luckfox-lyra-dsi-d300t9307v0.dtsi"
+//#include "rk3506-luckfox-lyra-dsi-d350t1013v1.dtsi"
 
 / {
 	model = "Luckfox Lyra Zero W";
-- 
2.34.1

